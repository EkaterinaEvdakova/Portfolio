# Проект "Так закаляем сталь"

Чтобы оптимизировать производственные расходы, металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали. Необходимо построить модель, которая предскажет температуру стали.

## Описание этапа обработки
Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша. 
Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).
Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.
Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (англ. slab, «плита»).

## Описание данных
Данные состоят из файлов, полученных из разных источников:
data_arc_new.csv — данные об электродах;
data_bulk_new.csv — данные о подаче сыпучих материалов (объём);
data_bulk_time_new.csv — данные о подаче сыпучих материалов (время);
data_gas_new.csv — данные о продувке сплава газом;
data_temp_new.csv — результаты измерения температуры;
data_wire_new.csv — данные о проволочных материалах (объём);
data_wire_time_new.csv — данные о проволочных материалах (время).
Во всех файлах столбец key содержит номер партии. В файлах может быть несколько строк с одинаковым значением key: они соответствуют разным итерациям обработки.

<b>Задача бизнеса:</b> оптимизировать производственные расходы, предсказав финальную температуру сплава перед розливом.

<b>Данные</b>
Данные состоят из файлов, полученных из разных источников:

- `data_arc_new.csv` — данные об электродах;
- `data_bulk_new.csv` — данные о подаче сыпучих материалов (объём);
- `data_bulk_time_new.csv` *—* данные о подаче сыпучих материалов (время);
- `data_gas_new.csv` — данные о продувке сплава газом;
- `data_temp_new.csv` — результаты измерения температуры;
- `data_wire_new.csv` — данные о проволочных материалах (объём);
- `data_wire_time_new.csv` — данные о проволочных материалах (время).

Во всех файлах столбец `key` содержит номер партии. В файлах может быть несколько строк с одинаковым значением `key`: они соответствуют разным итерациям обработки.

<b>Разделы отчета:</b>
1. Исследовательский анализ данных.
2.Предообработка данных.
3.Обучение модели.
4. Проверка качества модели на тестовых данных. 

В первом разделе были получены следующие результаты:
- В таблицах разное число уникальных партий.
- Данные в таблицах data_bulk_time и data_bulk имеют связь 1:1 и полностью согласуются.
- Данные в таблицах data_wire и data_wire_time имеют связь 1:1 и полностью согласуются.
- В таблице data_arc есть выброс, имеющий реактивную мощность -715.
- data_bulk, data_wire_time содержат информацию о времени добавления материалов к сплаву. data_temp - информацию о замере температуры. Согласно ТЗ сначала меряют температуру, потом добавляют материал - данные в таблицах это подтверждают.
- Данные в таблицах data_arc и data_gas скошены вправо.

На основе полученных данных был выполнен следующий <b>план действий</b>:
1. В обучении использовались только данные о тех партиях, которые есть во всех таблицах (23% данных было исключено). 

При исключении строк в таблицах(например: отрицательная реактивная мощность) исключены из рассмотрения все строки, относящиеся к этой партии. 

Удалены выбросы: отрицательная реактивная мощность, температура стали (последний замер) ниже порога 1400.
Всего было удалено 5 партий: 4 из-за низкой температуры плавки (возможно это отдельные партии с другими свойствами) и 1 из-за отрицательной большой реактивной мощности (возможно в этом случае не произошло погружения электродов в расплав, данную итерацию для обучения использовать было некорректно, вся партия была удалена из рассмотрения).

Таргет: конечное значение температуры для каждой партии (из таблицы data_temp для каждой партии - последняя по времени замера температуру). 

Фичи: 
- по каждой партии суммировано произведение (активная мощность*время нагрева дуги)
- начальное значение температуры сплава (из таблицы data_temp для каждой партии - первую по времени замера температуру)
- из таблиц  data_bulk и data_wire взяты все признаки (это объем добавленны материалов для каждой партии)
- объем газа для каждой партии.

Признаки были проверены на мультиколлинеарность. Был удален признак 'Wire 8'.

2. Разделены данные на тестовую, и обучающую выборку (0,25 размер тестовой, random_state = 080523).

3. Обучены модели для задачи регрессии (catboost, randomforest, полносвязная нейронная сеть) и  их качество оценено с помощью кросс-валидации. Метрика: MАE. 
Лучше всего себя показала модель catboost с параметрами:'depth': 2, 'iterations': 150, 'l2_leaf_reg': 5, 'learning_rate': 0.03. MAE = 6.9.

В пункте 5.1 дан график важности признаков для предсказания модели. Неудивительно, что первыми идут признаки: начальной температуры и энергии (согласуется с физическими законами). Высокая начальная температура и высокое значение энергии дают на выходе более высокое значение температуры сплава.
Далее видим влияние уже добавок, при этом только около 6 добавок влияют на распределение, остальные добавки почти не сдвигают прогноз модели.

4. MAE на тестовой выборке - 6.7. Цель работы достигнута.